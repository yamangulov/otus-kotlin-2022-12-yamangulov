Рассмотрел два варианта архитектуры:

1) взаимодействие с Clickhouse через http-интерфейс, в этом случае предполагается примерно такая архитектура:

![](/media/stranger/repo/otus-kotlin-2022-12-yamangulov/documentation/архитектура_http.png)

2) взаимодействие с Clickhouse через jdbc, odbc драйверы, или с использование драйвера mysql для построения архитектуры, близкой по типу к MVC с использованием Spring Data JPA с некоторыми доработками:

![](/media/stranger/repo/otus-kotlin-2022-12-yamangulov/documentation/архитектура_jpa.png)

Решил, что первый вариант - это скорее не архитектурное решение, а описание одного из вариантов реализации репозитория для второго варианта, просто обмен предполагается осуществлять через http протокол, а не ORM драйвер. На сам деле архитектура должна быть в более обобщенном виде такой:

![](/media/stranger/repo/otus-kotlin-2022-12-yamangulov/documentation/архитектура_обобщенная.png)

Здесь транспортным уровнем я назвал реализацию на любом обмене - либо http-запросов clickhouse, либо любой из orm драйверов. Уровень репозитория должен быть обобщенным на этот случай и уметь подключать любой из транспортов. Уровень сервиса опирается на репозиторий и не зависит от конкретной реализации транспорта. Уровень rest controller опирается на уровень service и не зависит от более нижележащих уровней.